# Микросервис постов
*Сервис*, отвечающий за работу с постами, комментариями к постам и комментариям, а также реакциями на посты и комментарии. Является частью микросервисной архитектуры проекта "Социальная сеть", где реализованы также микросервисы account, auth, country, dialog, notification, friends. Все микросервисы получают запросы на свои эндпоинты через Gateway, который выступает в качестве единой точки входа в микросервисную архитектуру. Он отвечает за маршрутизацию запросов от клиентов к нужным сервисам, а также может выполнять дополнительные функции, такие как аутентификация, авторизация, мониторинг и т.д.
Использование Kafka и Gateway позволяет обеспечить контролируемый доступ к микросервисам только для авторизованных пользователей. Gateway отвечает за аутентификацию и авторизацию пользователей, а Kafka обеспечивает безопасный и надежный обмен данными между сервисами. Таким образом, данный подход помогает повысить безопасность и масштабируемость микросервисной архитектуры.
## Принцип работы:
Пользователь регистрируется *(указывает e-mail и пароль)* и получает **token**, с помощью которого он может обращаться к любому сервису. Так, например, обратившись с запросом по адресу **(api/v1/post/**)** - включается в работу микросервис постов. В первую очередь, пользователя проверяют: mcpost извлекает token из запроса заголовок **Authorization** и отправляет по **RestTemplate в mcauth**, где в БД находятся все авторизованные пользователи с их данными. Если в БД mcauth найден пользователь, то из mcauth в mcpost возвращается ***true*** и ***accountDto*** с данными пользователя. Далее пользователь получает доступ к БД mcpost, откуда можно извлечь и предоставить данные о постах и комментариях.
________________________
## Конфигурация 
Приложения находится в файлах: *application.yaml, application-local.yaml и application-server.yaml*.
________________________
* application.yaml
** spring.profiles.active: активный профиль (можно запускать как на сервере "server", так и локально "local")
** spring.application.name: post
** spring.datasource: конфигурация подключения к базе данных PostgreSQL
** spring.liquibase: включение Liquibase для управления миграциями базы данных
** spring.kafka: конфигурация Kafka, включая адрес брокера и топик для уведомлений
** app.kafka: дополнительные настройки Kafka, включая название топика и группу сообщений
** server.port: порт, на котором будет запущен сервер
_________________________
* application-local.yaml
** spring.datasource.url: URL подключения к локальной базе данных PostgreSQL
** app.feignClient.url: URL локального Feign-клиента
** eureka: конфигурация Eureka-клиента для локального окружения
_________________________
* application-server.yaml
** spring.datasource.url: URL подключения к базе данных PostgreSQL в серверном окружении
** app.feignClient.url: URL Feign-клиента в серверном окружении (ip адрес сервера)
** eureka: конфигурация Eureka-клиента для серверного окружения
______________________
**Запуск**
1. Для запуска приложения в локальном окружении используйте профиль local:
./gradlew bootRun -Dspring.profiles.active=local
2. Для запуска в серверном окружении используйте профиль server:
./gradlew bootRun -Dspring.profiles.active=server
_______________________
**Зависимости**
+ Spring Boot
+ Spring Data JPA
+ Spring Kafka
+ Spring Security
+ Liquibase
+ Feign
+ Eureka
+ Gateway
+ TeamCity
